/**
 * Workers' Compensation Taxonomy Pack Seed
 *
 * 5 categories, ~42 fields, 25+ document types, action triggers,
 * reconciliation rules, and prompt templates for AI pipeline.
 */

import type {
  NewTaxonomyPack,
  NewTaxonomyCategory,
  NewTaxonomyField,
  NewTaxonomyDocumentType,
  NewTaxonomyActionTrigger,
  NewTaxonomyReconciliationRule,
  NewTaxonomyPromptTemplate,
} from "@/lib/db/schema";

// ---------------------------------------------------------------------------
// IDs (deterministic for seeding)
// ---------------------------------------------------------------------------

const PACK_ID = "de000000-0000-4000-b100-000000000001";

const CAT_IDS = {
  claimant: "de000000-0000-4000-b101-000000000001",
  injury: "de000000-0000-4000-b101-000000000002",
  employer: "de000000-0000-4000-b101-000000000003",
  medical: "de000000-0000-4000-b101-000000000004",
  benefits: "de000000-0000-4000-b101-000000000005",
};

// ---------------------------------------------------------------------------
// Pack
// ---------------------------------------------------------------------------

export const workersCompPack: NewTaxonomyPack & { id: string } = {
  id: PACK_ID,
  firmId: null,
  key: "workers-comp",
  version: "1.0.0",
  name: "Workers' Compensation",
  description:
    "Comprehensive extraction pack for workers' compensation claims including claimant info, injury details, employer data, medical records, and benefit calculations.",
  practiceArea: "workers_compensation",
  isSystem: true,
  isActive: true,
  parentPackId: null,
};

// ---------------------------------------------------------------------------
// Categories
// ---------------------------------------------------------------------------

export const workersCompCategories: (NewTaxonomyCategory & { id: string })[] = [
  {
    id: CAT_IDS.claimant,
    packId: PACK_ID,
    key: "claimant_info",
    label: "Claimant Information",
    description: "Personal details and contact information for the injured worker",
    icon: "user",
    color: "#3b82f6",
    sortOrder: 0,
  },
  {
    id: CAT_IDS.injury,
    packId: PACK_ID,
    key: "injury_details",
    label: "Injury Details",
    description: "Information about the workplace injury or illness",
    icon: "alert-triangle",
    color: "#ef4444",
    sortOrder: 1,
  },
  {
    id: CAT_IDS.employer,
    packId: PACK_ID,
    key: "employer_info",
    label: "Employer Information",
    description: "Employer details, insurance, and workplace information",
    icon: "building",
    color: "#8b5cf6",
    sortOrder: 2,
  },
  {
    id: CAT_IDS.medical,
    packId: PACK_ID,
    key: "medical_treatment",
    label: "Medical Treatment",
    description: "Medical providers, treatments, diagnoses, and prognosis",
    icon: "heart-pulse",
    color: "#10b981",
    sortOrder: 3,
  },
  {
    id: CAT_IDS.benefits,
    packId: PACK_ID,
    key: "benefits_compensation",
    label: "Benefits & Compensation",
    description: "Wage information, benefit calculations, and settlement details",
    icon: "dollar-sign",
    color: "#f59e0b",
    sortOrder: 4,
  },
];

// ---------------------------------------------------------------------------
// Fields (~42 total)
// ---------------------------------------------------------------------------

let fieldOrder = 0;

function makeFieldId(catPrefix: string, seq: number): string {
  return `de000000-0000-4000-b102-${catPrefix}${String(seq).padStart(4, "0")}`;
}

export const workersCompFields: NewTaxonomyField[] = [
  // --- Claimant Info (10 fields) ---
  {
    id: makeFieldId("01", 1),
    categoryId: CAT_IDS.claimant,
    key: "claimant_name",
    label: "Claimant Full Name",
    description: "Legal name of the injured worker",
    dataType: "text",
    examples: ["John Smith", "Maria Garcia-Lopez"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 2),
    categoryId: CAT_IDS.claimant,
    key: "date_of_birth",
    label: "Date of Birth",
    description: "Claimant's date of birth",
    dataType: "date",
    examples: ["1985-03-15", "1972-11-22"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 3),
    categoryId: CAT_IDS.claimant,
    key: "ssn_last4",
    label: "SSN (Last 4)",
    description: "Last 4 digits of Social Security Number",
    dataType: "text",
    examples: ["1234", "5678"],
    confidenceThreshold: "0.950",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 4),
    categoryId: CAT_IDS.claimant,
    key: "address",
    label: "Mailing Address",
    dataType: "text",
    examples: ["123 Main St, Springfield, IL 62701"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 5),
    categoryId: CAT_IDS.claimant,
    key: "phone",
    label: "Phone Number",
    dataType: "text",
    examples: ["(217) 555-0123"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 6),
    categoryId: CAT_IDS.claimant,
    key: "email",
    label: "Email Address",
    dataType: "text",
    examples: ["john.smith@email.com"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 7),
    categoryId: CAT_IDS.claimant,
    key: "marital_status",
    label: "Marital Status",
    dataType: "text",
    examples: ["Married", "Single", "Divorced"],
    confidenceThreshold: "0.750",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 8),
    categoryId: CAT_IDS.claimant,
    key: "dependents_count",
    label: "Number of Dependents",
    dataType: "number",
    examples: ["2", "0", "3"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 9),
    categoryId: CAT_IDS.claimant,
    key: "occupation",
    label: "Occupation / Job Title",
    dataType: "text",
    examples: ["Warehouse Worker", "Construction Foreman"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("01", 10),
    categoryId: CAT_IDS.claimant,
    key: "hire_date",
    label: "Date of Hire",
    dataType: "date",
    examples: ["2018-06-01"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },

  // --- Injury Details (9 fields) ---
  {
    id: makeFieldId("02", 1),
    categoryId: CAT_IDS.injury,
    key: "injury_date",
    label: "Date of Injury",
    description: "Date when the workplace injury occurred",
    dataType: "date",
    examples: ["2025-01-15"],
    confidenceThreshold: "0.900",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 2),
    categoryId: CAT_IDS.injury,
    key: "injury_time",
    label: "Time of Injury",
    dataType: "text",
    examples: ["2:30 PM", "08:45"],
    confidenceThreshold: "0.750",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 3),
    categoryId: CAT_IDS.injury,
    key: "injury_location",
    label: "Location of Injury",
    description: "Where the injury occurred (address or description)",
    dataType: "text",
    examples: ["Loading dock, Building C", "Construction site at 456 Oak Ave"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 4),
    categoryId: CAT_IDS.injury,
    key: "injury_description",
    label: "Description of Injury",
    description: "How the injury occurred",
    dataType: "text",
    examples: ["Slipped on wet floor and fell, striking right knee on concrete"],
    confidenceThreshold: "0.750",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 5),
    categoryId: CAT_IDS.injury,
    key: "body_parts_affected",
    label: "Body Parts Affected",
    dataType: "text",
    examples: ["Lower back, right knee", "Left shoulder, neck"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 6),
    categoryId: CAT_IDS.injury,
    key: "injury_type",
    label: "Type of Injury",
    dataType: "text",
    examples: ["Strain/Sprain", "Fracture", "Contusion", "Repetitive Motion"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 7),
    categoryId: CAT_IDS.injury,
    key: "cause_of_injury",
    label: "Cause of Injury",
    dataType: "text",
    examples: ["Fall from height", "Lifting heavy object", "Vehicle accident"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 8),
    categoryId: CAT_IDS.injury,
    key: "witnesses",
    label: "Witnesses",
    dataType: "text",
    examples: ["Mike Johnson (supervisor), ext. 234"],
    confidenceThreshold: "0.700",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("02", 9),
    categoryId: CAT_IDS.injury,
    key: "statute_of_limitation_date",
    label: "Statute of Limitations Date",
    description: "Filing deadline for the workers' comp claim",
    dataType: "date",
    examples: ["2027-01-15"],
    confidenceThreshold: "0.900",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },

  // --- Employer Info (8 fields) ---
  {
    id: makeFieldId("03", 1),
    categoryId: CAT_IDS.employer,
    key: "employer_name",
    label: "Employer Name",
    dataType: "text",
    examples: ["Acme Manufacturing Inc.", "Springfield Construction LLC"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("03", 2),
    categoryId: CAT_IDS.employer,
    key: "employer_address",
    label: "Employer Address",
    dataType: "text",
    examples: ["789 Industrial Pkwy, Springfield, IL 62704"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("03", 3),
    categoryId: CAT_IDS.employer,
    key: "employer_fein",
    label: "Employer FEIN",
    description: "Federal Employer Identification Number",
    dataType: "text",
    examples: ["36-1234567"],
    confidenceThreshold: "0.900",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("03", 4),
    categoryId: CAT_IDS.employer,
    key: "insurance_carrier",
    label: "Insurance Carrier",
    dataType: "text",
    examples: ["Hartford Insurance", "Liberty Mutual"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("03", 5),
    categoryId: CAT_IDS.employer,
    key: "policy_number",
    label: "Policy Number",
    dataType: "text",
    examples: ["WC-2025-123456"],
    confidenceThreshold: "0.900",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("03", 6),
    categoryId: CAT_IDS.employer,
    key: "claim_number",
    label: "Claim Number",
    dataType: "text",
    examples: ["CLM-2025-00789"],
    confidenceThreshold: "0.900",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("03", 7),
    categoryId: CAT_IDS.employer,
    key: "adjuster_name",
    label: "Claims Adjuster",
    dataType: "text",
    examples: ["Sandra Wilson"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("03", 8),
    categoryId: CAT_IDS.employer,
    key: "employer_contested",
    label: "Employer Contesting Claim",
    dataType: "boolean",
    examples: ["true", "false"],
    confidenceThreshold: "0.800",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },

  // --- Medical Treatment (8 fields) ---
  {
    id: makeFieldId("04", 1),
    categoryId: CAT_IDS.medical,
    key: "treating_physician",
    label: "Treating Physician",
    dataType: "text",
    examples: ["Dr. Robert Chen, MD"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("04", 2),
    categoryId: CAT_IDS.medical,
    key: "diagnosis",
    label: "Primary Diagnosis",
    description: "Primary medical diagnosis with ICD code if available",
    dataType: "text",
    examples: ["Lumbar disc herniation (M51.16)", "Rotator cuff tear (M75.11)"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("04", 3),
    categoryId: CAT_IDS.medical,
    key: "secondary_diagnoses",
    label: "Secondary Diagnoses",
    dataType: "text",
    examples: ["Cervical radiculopathy, anxiety disorder"],
    confidenceThreshold: "0.750",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("04", 4),
    categoryId: CAT_IDS.medical,
    key: "treatment_summary",
    label: "Treatment Summary",
    dataType: "text",
    examples: ["Physical therapy 3x/week, prescribed Gabapentin 300mg"],
    confidenceThreshold: "0.750",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("04", 5),
    categoryId: CAT_IDS.medical,
    key: "surgery_date",
    label: "Surgery Date",
    dataType: "date",
    examples: ["2025-03-20"],
    confidenceThreshold: "0.900",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("04", 6),
    categoryId: CAT_IDS.medical,
    key: "mmi_date",
    label: "MMI Date",
    description: "Maximum Medical Improvement date",
    dataType: "date",
    examples: ["2025-09-15"],
    confidenceThreshold: "0.900",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("04", 7),
    categoryId: CAT_IDS.medical,
    key: "impairment_rating",
    label: "Impairment Rating (%)",
    description: "Permanent impairment rating percentage",
    dataType: "percentage",
    examples: ["12%", "8.5%"],
    confidenceThreshold: "0.900",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("04", 8),
    categoryId: CAT_IDS.medical,
    key: "work_restrictions",
    label: "Work Restrictions",
    dataType: "text",
    examples: ["No lifting over 20 lbs, no repetitive bending"],
    confidenceThreshold: "0.800",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },

  // --- Benefits & Compensation (7 fields) ---
  {
    id: makeFieldId("05", 1),
    categoryId: CAT_IDS.benefits,
    key: "average_weekly_wage",
    label: "Average Weekly Wage",
    dataType: "currency",
    examples: ["$850.00", "$1,200.50"],
    confidenceThreshold: "0.900",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("05", 2),
    categoryId: CAT_IDS.benefits,
    key: "compensation_rate",
    label: "Compensation Rate",
    description: "Weekly TTD/TPD benefit rate",
    dataType: "currency",
    examples: ["$566.67"],
    confidenceThreshold: "0.900",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("05", 3),
    categoryId: CAT_IDS.benefits,
    key: "ttd_start_date",
    label: "TTD Start Date",
    description: "Temporary Total Disability start date",
    dataType: "date",
    examples: ["2025-01-16"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("05", 4),
    categoryId: CAT_IDS.benefits,
    key: "ttd_end_date",
    label: "TTD End Date",
    dataType: "date",
    examples: ["2025-06-30"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("05", 5),
    categoryId: CAT_IDS.benefits,
    key: "total_medical_expenses",
    label: "Total Medical Expenses",
    dataType: "currency",
    examples: ["$45,230.00"],
    confidenceThreshold: "0.850",
    requiresHumanReview: false,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("05", 6),
    categoryId: CAT_IDS.benefits,
    key: "settlement_amount",
    label: "Settlement Amount",
    dataType: "currency",
    examples: ["$125,000.00"],
    confidenceThreshold: "0.950",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },
  {
    id: makeFieldId("05", 7),
    categoryId: CAT_IDS.benefits,
    key: "attorney_fees",
    label: "Attorney Fees",
    dataType: "currency",
    examples: ["$25,000.00"],
    confidenceThreshold: "0.900",
    requiresHumanReview: true,
    sortOrder: fieldOrder++,
  },
];

// ---------------------------------------------------------------------------
// Document Types (25+)
// ---------------------------------------------------------------------------

let dtOrder = 0;

function makeDtId(seq: number): string {
  return `de000000-0000-4000-b103-${String(seq).padStart(12, "0")}`;
}

export const workersCompDocTypes: NewTaxonomyDocumentType[] = [
  // --- Initial Filing ---
  {
    id: makeDtId(1),
    packId: PACK_ID,
    key: "first_report_of_injury",
    label: "First Report of Injury",
    description: "Employer's initial report of workplace injury",
    activatedCategories: ["claimant_info", "injury_details", "employer_info"],
    classificationHints: "Contains employer report, injury description, and worker information",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(2),
    packId: PACK_ID,
    key: "claim_petition",
    label: "Claim Petition / Application",
    description: "Worker's formal claim filing",
    activatedCategories: [
      "claimant_info",
      "injury_details",
      "employer_info",
      "benefits_compensation",
    ],
    classificationHints: "Legal petition or application for workers' compensation benefits",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(3),
    packId: PACK_ID,
    key: "notice_of_claim",
    label: "Notice of Claim",
    activatedCategories: ["claimant_info", "injury_details", "employer_info"],
    classificationHints: "Written notice from worker to employer about injury",
    sortOrder: dtOrder++,
  },

  // --- Medical ---
  {
    id: makeDtId(4),
    packId: PACK_ID,
    key: "medical_report",
    label: "Medical Report",
    description: "Physician's report on diagnosis and treatment",
    activatedCategories: ["claimant_info", "injury_details", "medical_treatment"],
    classificationHints: "Contains medical diagnoses, treatment plans, clinical findings",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(5),
    packId: PACK_ID,
    key: "medical_records",
    label: "Medical Records / Chart Notes",
    activatedCategories: ["medical_treatment"],
    classificationHints: "Hospital or clinic records, chart notes, lab results",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(6),
    packId: PACK_ID,
    key: "operative_report",
    label: "Operative Report",
    activatedCategories: ["medical_treatment", "injury_details"],
    classificationHints: "Surgical procedure report with operative findings",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(7),
    packId: PACK_ID,
    key: "independent_medical_exam",
    label: "Independent Medical Exam (IME)",
    description: "Defense-requested medical evaluation",
    activatedCategories: ["claimant_info", "injury_details", "medical_treatment"],
    classificationHints: "IME report, defense medical examination, compulsory exam",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(8),
    packId: PACK_ID,
    key: "functional_capacity_eval",
    label: "Functional Capacity Evaluation (FCE)",
    activatedCategories: ["medical_treatment"],
    classificationHints: "Physical capacity testing, work capability assessment",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(9),
    packId: PACK_ID,
    key: "mmi_report",
    label: "MMI Report",
    description: "Maximum Medical Improvement determination",
    activatedCategories: ["medical_treatment", "benefits_compensation"],
    classificationHints: "MMI determination, permanent impairment rating, final medical status",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(10),
    packId: PACK_ID,
    key: "prescription_records",
    label: "Prescription Records",
    activatedCategories: ["medical_treatment"],
    classificationHints: "Medication list, pharmacy records, prescription history",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(11),
    packId: PACK_ID,
    key: "physical_therapy_notes",
    label: "Physical Therapy Notes",
    activatedCategories: ["medical_treatment"],
    classificationHints: "PT session notes, rehabilitation progress, therapy plan",
    sortOrder: dtOrder++,
  },

  // --- Employment / Wage ---
  {
    id: makeDtId(12),
    packId: PACK_ID,
    key: "wage_statement",
    label: "Wage Statement / Pay Records",
    description: "Earnings history for AWW calculation",
    activatedCategories: ["claimant_info", "employer_info", "benefits_compensation"],
    classificationHints: "Pay stubs, W-2, earnings statement, wage records",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(13),
    packId: PACK_ID,
    key: "employment_records",
    label: "Employment Records",
    activatedCategories: ["claimant_info", "employer_info"],
    classificationHints: "Employment application, job description, personnel file",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(14),
    packId: PACK_ID,
    key: "job_description",
    label: "Job Description",
    activatedCategories: ["claimant_info", "employer_info"],
    classificationHints: "Position duties, physical requirements, job functions",
    sortOrder: dtOrder++,
  },

  // --- Legal / Administrative ---
  {
    id: makeDtId(15),
    packId: PACK_ID,
    key: "denial_letter",
    label: "Claim Denial Letter",
    activatedCategories: ["employer_info", "injury_details"],
    classificationHints: "Insurance carrier denial of claim, dispute letter",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(16),
    packId: PACK_ID,
    key: "hearing_order",
    label: "Hearing Order / Decision",
    activatedCategories: ["injury_details", "benefits_compensation"],
    classificationHints: "Workers' comp commission order, judge decision, hearing outcome",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(17),
    packId: PACK_ID,
    key: "settlement_agreement",
    label: "Settlement Agreement",
    activatedCategories: ["claimant_info", "benefits_compensation"],
    classificationHints: "Compromise and release, settlement, stipulated agreement",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(18),
    packId: PACK_ID,
    key: "deposition_transcript",
    label: "Deposition Transcript",
    activatedCategories: ["claimant_info", "injury_details", "medical_treatment"],
    classificationHints: "Sworn testimony, deposition, examination under oath",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(19),
    packId: PACK_ID,
    key: "attorney_correspondence",
    label: "Attorney Correspondence",
    activatedCategories: ["claimant_info", "employer_info"],
    classificationHints: "Demand letter, attorney letter, legal correspondence",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(20),
    packId: PACK_ID,
    key: "benefit_notice",
    label: "Benefit Notice / Award",
    activatedCategories: ["benefits_compensation"],
    classificationHints: "Benefit payment notice, award letter, compensation order",
    sortOrder: dtOrder++,
  },

  // --- Insurance / Administrative ---
  {
    id: makeDtId(21),
    packId: PACK_ID,
    key: "insurance_policy",
    label: "Insurance Policy",
    activatedCategories: ["employer_info"],
    classificationHints: "Workers' comp insurance policy, coverage declaration",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(22),
    packId: PACK_ID,
    key: "incident_report",
    label: "Incident Report",
    activatedCategories: ["injury_details", "employer_info"],
    classificationHints: "Workplace incident report, accident investigation, safety report",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(23),
    packId: PACK_ID,
    key: "osha_report",
    label: "OSHA Report / Citation",
    activatedCategories: ["injury_details", "employer_info"],
    classificationHints: "OSHA inspection, safety violation, workplace safety report",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(24),
    packId: PACK_ID,
    key: "vocational_assessment",
    label: "Vocational Assessment",
    activatedCategories: ["claimant_info", "medical_treatment", "benefits_compensation"],
    classificationHints: "Vocational rehabilitation, transferable skills, labor market analysis",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(25),
    packId: PACK_ID,
    key: "return_to_work_plan",
    label: "Return to Work Plan",
    activatedCategories: ["medical_treatment", "employer_info"],
    classificationHints: "Modified duty offer, return to work program, work release",
    sortOrder: dtOrder++,
  },
  {
    id: makeDtId(26),
    packId: PACK_ID,
    key: "surveillance_report",
    label: "Surveillance Report",
    activatedCategories: ["claimant_info", "injury_details"],
    classificationHints: "Sub rosa surveillance, investigation report, activity log",
    sortOrder: dtOrder++,
  },
];

// ---------------------------------------------------------------------------
// Action Triggers
// ---------------------------------------------------------------------------

let triggerOrder = 0;

function makeTriggerId(seq: number): string {
  return `de000000-0000-4000-b104-${String(seq).padStart(12, "0")}`;
}

export const workersCompTriggers: (NewTaxonomyActionTrigger & { id: string })[] = [
  {
    id: makeTriggerId(1),
    packId: PACK_ID,
    triggerType: "deadline",
    name: "Statute of Limitations Alert",
    description: "Creates a deadline task when a statute of limitations date is extracted",
    triggerCondition: {
      fieldKey: "statute_of_limitation_date",
      categoryKey: "injury_details",
      operator: "exists",
    },
    actionTemplate: {
      actionType: "create_deadline",
      title: "Statute of Limitations Deadline",
      description:
        "Filing deadline for workers' compensation claim — verify jurisdiction-specific rules",
      priority: 0,
    },
    jurisdictionSpecific: true,
    jurisdictionRules: {
      IL: { years: 3, note: "3 years from injury date per 820 ILCS 305/6(d)" },
      CA: { years: 1, note: "1 year from injury date per LC §5405" },
      NY: { years: 2, note: "2 years from injury date per WCL §28" },
    },
    isDeterministic: true,
  },
  {
    id: makeTriggerId(2),
    packId: PACK_ID,
    triggerType: "alert",
    name: "Claim Denial Detected",
    description: "Flags the matter when a denial letter is processed",
    triggerCondition: {
      fieldKey: "employer_contested",
      categoryKey: "employer_info",
      operator: "equals",
      value: "true",
    },
    actionTemplate: {
      actionType: "flag_risk",
      title: "Employer Contesting Claim",
      description:
        "Employer or insurance carrier has denied or contested the claim. Prepare for potential hearing.",
      priority: 0,
    },
    jurisdictionSpecific: false,
    isDeterministic: true,
  },
  {
    id: makeTriggerId(3),
    packId: PACK_ID,
    triggerType: "recommendation",
    name: "MMI Date Approaching",
    description: "Creates a task when MMI date is within 30 days",
    triggerCondition: {
      fieldKey: "mmi_date",
      categoryKey: "medical_treatment",
      operator: "date_within_days",
      value: 30,
    },
    actionTemplate: {
      actionType: "create_task",
      title: "Prepare for MMI — Impairment Rating Review",
      description:
        "Maximum Medical Improvement date is approaching. Arrange for impairment rating evaluation and review settlement options.",
      priority: 1,
    },
    jurisdictionSpecific: false,
    isDeterministic: true,
  },
  {
    id: makeTriggerId(4),
    packId: PACK_ID,
    triggerType: "alert",
    name: "High Settlement Amount",
    description: "Flags settlements above $100,000 for partner review",
    triggerCondition: {
      fieldKey: "settlement_amount",
      categoryKey: "benefits_compensation",
      operator: "gt",
      value: 100000,
    },
    actionTemplate: {
      actionType: "request_review",
      title: "High-Value Settlement — Partner Review Required",
      description:
        "Settlement amount exceeds $100,000 threshold. Partner review and approval needed.",
      priority: 0,
    },
    jurisdictionSpecific: false,
    isDeterministic: true,
  },
  {
    id: makeTriggerId(5),
    packId: PACK_ID,
    triggerType: "recommendation",
    name: "Impairment Rating Detected",
    description: "Creates review task when permanent impairment rating is found",
    triggerCondition: {
      fieldKey: "impairment_rating",
      categoryKey: "medical_treatment",
      operator: "exists",
    },
    actionTemplate: {
      actionType: "create_task",
      title: "Review Impairment Rating — Verify AMA Guides Compliance",
      description:
        "Permanent impairment rating extracted. Verify rating methodology and consider independent evaluation if needed.",
      priority: 1,
    },
    jurisdictionSpecific: false,
    isDeterministic: true,
  },
  {
    id: makeTriggerId(6),
    packId: PACK_ID,
    triggerType: "status_change",
    name: "TTD Benefits Tracking",
    description: "Creates tracking task when TTD dates are identified",
    triggerCondition: {
      fieldKey: "ttd_start_date",
      categoryKey: "benefits_compensation",
      operator: "exists",
    },
    actionTemplate: {
      actionType: "create_task",
      title: "Track TTD Benefit Payments",
      description:
        "TTD period identified. Verify benefit payments are being made correctly and track any gaps.",
      priority: 2,
    },
    jurisdictionSpecific: false,
    isDeterministic: true,
  },
];

// ---------------------------------------------------------------------------
// Reconciliation Rules
// ---------------------------------------------------------------------------

let ruleOrder = 0;

function makeRuleId(seq: number): string {
  return `de000000-0000-4000-b105-${String(seq).padStart(12, "0")}`;
}

export const workersCompReconciliationRules: (NewTaxonomyReconciliationRule & { id: string })[] = [
  {
    id: makeRuleId(1),
    packId: PACK_ID,
    fieldKey: "claimant_name",
    caseFieldMapping: "client.name",
    conflictDetectionMode: "fuzzy_text",
    autoApplyThreshold: "0.900",
    requiresHumanReview: false,
  },
  {
    id: makeRuleId(2),
    packId: PACK_ID,
    fieldKey: "date_of_birth",
    caseFieldMapping: "client.dateOfBirth",
    conflictDetectionMode: "date_range",
    autoApplyThreshold: "0.900",
    requiresHumanReview: false,
  },
  {
    id: makeRuleId(3),
    packId: PACK_ID,
    fieldKey: "injury_date",
    caseFieldMapping: "matter.injuryDate",
    conflictDetectionMode: "date_range",
    autoApplyThreshold: "0.950",
    requiresHumanReview: false,
  },
  {
    id: makeRuleId(4),
    packId: PACK_ID,
    fieldKey: "employer_name",
    caseFieldMapping: "matter.employerName",
    conflictDetectionMode: "fuzzy_text",
    autoApplyThreshold: "0.850",
    requiresHumanReview: false,
  },
  {
    id: makeRuleId(5),
    packId: PACK_ID,
    fieldKey: "claim_number",
    caseFieldMapping: "matter.claimNumber",
    conflictDetectionMode: "exact",
    autoApplyThreshold: "0.950",
    requiresHumanReview: false,
  },
  {
    id: makeRuleId(6),
    packId: PACK_ID,
    fieldKey: "policy_number",
    caseFieldMapping: "matter.policyNumber",
    conflictDetectionMode: "exact",
    autoApplyThreshold: "0.950",
    requiresHumanReview: false,
  },
  {
    id: makeRuleId(7),
    packId: PACK_ID,
    fieldKey: "diagnosis",
    caseFieldMapping: "matter.diagnosis",
    conflictDetectionMode: "fuzzy_text",
    autoApplyThreshold: "0.800",
    requiresHumanReview: true,
  },
  {
    id: makeRuleId(8),
    packId: PACK_ID,
    fieldKey: "average_weekly_wage",
    caseFieldMapping: "matter.averageWeeklyWage",
    conflictDetectionMode: "fuzzy_number",
    autoApplyThreshold: "0.900",
    requiresHumanReview: false,
  },
  {
    id: makeRuleId(9),
    packId: PACK_ID,
    fieldKey: "settlement_amount",
    caseFieldMapping: "matter.settlementAmount",
    conflictDetectionMode: "exact",
    autoApplyThreshold: "0.990",
    requiresHumanReview: true,
  },
  {
    id: makeRuleId(10),
    packId: PACK_ID,
    fieldKey: "impairment_rating",
    caseFieldMapping: "matter.impairmentRating",
    conflictDetectionMode: "fuzzy_number",
    autoApplyThreshold: "0.900",
    requiresHumanReview: true,
  },
];

// ---------------------------------------------------------------------------
// Prompt Templates
// ---------------------------------------------------------------------------

export const workersCompPromptTemplates: NewTaxonomyPromptTemplate[] = [
  {
    id: "de000000-0000-4000-b106-000000000001",
    packId: PACK_ID,
    templateType: "classification",
    systemPrompt: `You are a legal document classifier specializing in workers' compensation cases. Classify the document into one of the provided types based on its content. Focus on identifying the document's primary purpose in the context of a workers' comp claim.`,
    userPromptTemplate: `Available document types:\n{{document_types}}\n\nAnalyze the following text excerpt and classify it into one of the document types above. Return JSON with "documentType" (the key) and "confidence" (0-1).\n\nText:\n{{text_sample}}`,
    modelPreference: "google/gemini-2.0-flash-001",
    temperature: "0.100",
    maxTokens: 256,
  },
  {
    id: "de000000-0000-4000-b106-000000000002",
    packId: PACK_ID,
    templateType: "extraction",
    systemPrompt: `You are a legal document extraction specialist for workers' compensation cases. Extract structured data from document text. Be precise with names, dates, dollar amounts, and medical terminology. If a value is uncertain, assign a lower confidence score. Only extract values that are explicitly stated in the text.`,
    userPromptTemplate: `Extract the following fields from this workers' compensation document.\n\nFields to extract:\n{{field_descriptions}}\n\nDocument type: {{document_type}}\n{{chunk_text}}\n\nReturn a JSON array of findings. Each finding: {"categoryKey": string, "fieldKey": string, "value": string, "sourceQuote": string, "confidence": number (0-1)}.\nOnly include fields that have values in the text. Be precise and conservative with confidence scores.`,
    modelPreference: "google/gemini-2.0-flash-001",
    temperature: "0.100",
    maxTokens: 2048,
  },
];

// ---------------------------------------------------------------------------
// Aggregate export
// ---------------------------------------------------------------------------

export const workersCompSeed = {
  pack: workersCompPack,
  categories: workersCompCategories,
  fields: workersCompFields,
  documentTypes: workersCompDocTypes,
  triggers: workersCompTriggers,
  reconciliationRules: workersCompReconciliationRules,
  promptTemplates: workersCompPromptTemplates,
};
