import { db } from "@/lib/db";
import { matters } from "@/lib/db/schema";
import { DEMO_IDS } from "../ids";
import { SeederContext } from "../types";

export async function seedMatters(ctx: SeederContext) {
  const now = ctx.now;

  const mattersData = [
    {
      id: DEMO_IDS.matters.conveyancing,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual,
      title: "Purchase of 15 Willow Lane, Richmond",
      reference: "MAT-DEMO-001",
      practiceArea: "conveyancing" as const,
      subType: "freehold_purchase",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate,
      description: "Freehold residential purchase. Price: £850,000. Mortgage with Nationwide.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.litigation,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.company,
      title: "Apex vs. BuildRight - Construction Defects Claim",
      reference: "MAT-DEMO-002",
      practiceArea: "litigation" as const,
      subType: "construction_dispute",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.partner,
      description: "Claim against contractor for defective foundation works. Value: £2.4m.",
      createdAt: now,
      updatedAt: now,
    },
    // Conveyancing matters (3 more)
    {
      id: DEMO_IDS.matters.conveyancingSale,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual,
      title: "Sale of 42 Kensington Gardens, London",
      reference: "MAT-DEMO-003",
      practiceArea: "conveyancing" as const,
      subType: "freehold_sale",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate2,
      description: "Freehold sale. Price: £1,250,000. Chain of 3 properties.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.conveyancingRemortgage,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.company,
      title: "Remortgage of 100 Deansgate, Manchester",
      reference: "MAT-DEMO-004",
      practiceArea: "conveyancing" as const,
      subType: "remortgage",
      status: "closed" as const,
      feeEarnerId: DEMO_IDS.users.paralegal1,
      description: "Commercial remortgage. Value: £3.5m with HSBC.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.conveyancingLeasehold,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual6,
      title: "Leasehold Purchase - Flat 4B, The Galleries, Leeds",
      reference: "MAT-DEMO-005",
      practiceArea: "conveyancing" as const,
      subType: "leasehold_purchase",
      status: "lead" as const,
      feeEarnerId: DEMO_IDS.users.associate2,
      description: "Leasehold flat purchase. Price: £320,000. 99 years remaining on lease.",
      createdAt: now,
      updatedAt: now,
    },
    // Litigation matters (2 more)
    {
      id: DEMO_IDS.matters.litigationDebt,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.company,
      title: "Debt Recovery - Outstanding Invoice £45,000",
      reference: "MAT-DEMO-006",
      practiceArea: "litigation" as const,
      subType: "debt_recovery",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate3,
      description: "Recovering unpaid invoices from former client. Claim issued in County Court.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.litigationContract,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.company4,
      title: "Breach of Contract - Supply Agreement Dispute",
      reference: "MAT-DEMO-007",
      practiceArea: "litigation" as const,
      subType: "contract_dispute",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.seniorPartner,
      description: "Supplier failed to deliver materials per agreement. Claim value: £180,000.",
      createdAt: now,
      updatedAt: now,
    },
    // Personal Injury matters (4)
    {
      id: DEMO_IDS.matters.personalInjuryRTA,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual3,
      title: "RTA Personal Injury - M6 Motorway Collision",
      reference: "MAT-DEMO-008",
      practiceArea: "personal_injury" as const,
      subType: "road_traffic_accident",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.partner,
      description:
        "Whiplash and soft tissue injuries. Liability admitted. Medical reports pending.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.personalInjuryWorkplace,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual4,
      title: "Workplace Accident - Slipped Disc Injury",
      reference: "MAT-DEMO-009",
      practiceArea: "personal_injury" as const,
      subType: "workplace_accident",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.partner,
      description:
        "Manual handling injury at warehouse. Employer liability claim. Off work 6 months.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.personalInjurySlip,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual5,
      title: "Slip and Fall - Supermarket Public Liability",
      reference: "MAT-DEMO-010",
      practiceArea: "personal_injury" as const,
      subType: "public_liability",
      status: "closed" as const,
      feeEarnerId: DEMO_IDS.users.associate,
      description: "Fractured wrist from wet floor. Settled at £8,500 plus costs.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.personalInjuryCICA,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual6,
      title: "CICA Criminal Injuries Compensation Application",
      reference: "MAT-DEMO-011",
      practiceArea: "personal_injury" as const,
      subType: "criminal_injuries",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.partner,
      description: "Assault victim. Psychological injury claim. CICA application submitted.",
      createdAt: now,
      updatedAt: now,
    },
    // Family matters (3)
    {
      id: DEMO_IDS.matters.familyDivorce,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual,
      title: "Divorce - Thompson Matrimonial Proceedings",
      reference: "MAT-DEMO-012",
      practiceArea: "family" as const,
      subType: "divorce_petition",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate2,
      description: "Divorce petition filed. Financial disclosure ongoing. No children.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.familyChild,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual7,
      title: "Child Arrangements Order Application",
      reference: "MAT-DEMO-013",
      practiceArea: "family" as const,
      subType: "child_arrangements",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate2,
      description: "Seeking shared custody arrangement. CAFCASS report ordered.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.familyPrenup,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual8,
      title: "Prenuptial Agreement - High Net Worth",
      reference: "MAT-DEMO-014",
      practiceArea: "family" as const,
      subType: "prenuptial_agreement",
      status: "lead" as const,
      feeEarnerId: DEMO_IDS.users.seniorPartner,
      description: "Drafting prenup for wedding in 3 months. Assets include property portfolio.",
      createdAt: now,
      updatedAt: now,
    },
    // Employment matters (3)
    {
      id: DEMO_IDS.matters.employmentDismissal,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual3,
      title: "Unfair Dismissal Tribunal Claim",
      reference: "MAT-DEMO-015",
      practiceArea: "employment" as const,
      subType: "unfair_dismissal",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate3,
      description: "Senior manager dismissed without proper procedure. ET claim lodged.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.employmentRedundancy,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual4,
      title: "Redundancy - Selection Process Challenge",
      reference: "MAT-DEMO-016",
      practiceArea: "employment" as const,
      subType: "redundancy",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate3,
      description: "Challenging unfair redundancy selection criteria. 15 years service.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.employmentSettlement,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual5,
      title: "Settlement Agreement Negotiation",
      reference: "MAT-DEMO-017",
      practiceArea: "employment" as const,
      subType: "settlement_agreement",
      status: "closed" as const,
      feeEarnerId: DEMO_IDS.users.associate3,
      description: "Exit package negotiated. £75,000 settlement plus legal costs.",
      createdAt: now,
      updatedAt: now,
    },
    // Probate matters (3)
    {
      id: DEMO_IDS.matters.probateEstate,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.estate1,
      title: "Estate Administration - Estate of John Roberts",
      reference: "MAT-DEMO-018",
      practiceArea: "probate" as const,
      subType: "grant_of_probate",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.paralegal2,
      description: "Standard probate. Estate value £450,000. Three beneficiaries.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.probateDispute,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual7,
      title: "Will Dispute - Inheritance Act Claim",
      reference: "MAT-DEMO-019",
      practiceArea: "probate" as const,
      subType: "will_dispute",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.seniorPartner,
      description: "Adult child excluded from will. Reasonable provision claim under I(PFD)A 1975.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.probateGrant,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual8,
      title: "Grant of Probate Application - Intestacy",
      reference: "MAT-DEMO-020",
      practiceArea: "probate" as const,
      subType: "grant_of_probate",
      status: "lead" as const,
      feeEarnerId: DEMO_IDS.users.paralegal2,
      description: "Died without will. Spouse and two children. Estate value £280,000.",
      createdAt: now,
      updatedAt: now,
    },
    // Criminal matters (2)
    {
      id: DEMO_IDS.matters.criminalDriving,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual3,
      title: "Drink Driving Defence - Magistrates Court",
      reference: "MAT-DEMO-021",
      practiceArea: "criminal" as const,
      subType: "driving_offences",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate,
      description: "Client charged with drink driving. Reading 95mg. Procedural defence possible.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.criminalFraud,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual4,
      title: "Fraud by False Representation - Crown Court",
      reference: "MAT-DEMO-022",
      practiceArea: "criminal" as const,
      subType: "fraud",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.seniorPartner,
      description: "Company director charged with VAT fraud. Value £120,000. Trial listed.",
      createdAt: now,
      updatedAt: now,
    },
    // Immigration matters (2)
    {
      id: DEMO_IDS.matters.immigrationTier2,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.company3,
      title: "Skilled Worker Visa Application - Software Engineer",
      reference: "MAT-DEMO-023",
      practiceArea: "immigration" as const,
      subType: "skilled_worker_visa",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.associate2,
      description: "Certificate of Sponsorship issued. Application prepared for submission.",
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.matters.immigrationSpouse,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.individual6,
      title: "Spouse Visa Extension Application",
      reference: "MAT-DEMO-024",
      practiceArea: "immigration" as const,
      subType: "spouse_visa",
      status: "lead" as const,
      feeEarnerId: DEMO_IDS.users.associate2,
      description: "Initial visa expires in 2 months. Financial requirement evidence gathering.",
      createdAt: now,
      updatedAt: now,
    },
    // Commercial matter (1)
    {
      id: DEMO_IDS.matters.commercialShareholder,
      firmId: DEMO_IDS.firm,
      clientId: DEMO_IDS.clients.company3,
      title: "Shareholder Agreement - Tech Startup",
      reference: "MAT-DEMO-025",
      practiceArea: "commercial" as const,
      subType: "shareholder_agreement",
      status: "active" as const,
      feeEarnerId: DEMO_IDS.users.seniorPartner,
      description: "Drafting shareholders agreement. Series A funding. 4 founders.",
      createdAt: now,
      updatedAt: now,
    },
  ];

  const createdMatters: Array<{ id: string; title: string; practiceArea: string }> = [];

  for (const matterData of mattersData) {
    const [matter] = await db
      .insert(matters)
      .values(matterData)
      .onConflictDoUpdate({
        target: matters.id,
        set: { updatedAt: now, subType: matterData.subType },
      })
      .returning();

    createdMatters.push({
      id: matter.id,
      title: matter.title,
      practiceArea: matter.practiceArea,
    });
    console.log(`    Created matter: ${matter.title}`);
  }

  return createdMatters;
}
