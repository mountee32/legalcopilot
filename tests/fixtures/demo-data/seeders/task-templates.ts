import { db } from "@/lib/db";
import { taskTemplates, taskTemplateItems } from "@/lib/db/schema";
import { DEMO_IDS } from "../ids";
import type { SeederContext } from "../types";

/**
 * Seeds system task templates for common practice areas.
 * These are system templates (firmId = null) available to all firms.
 */
export async function seedTaskTemplates(ctx: SeederContext) {
  console.log("  Seeding task templates...");

  const now = ctx.now;

  // ================================================
  // TEMPLATES
  // ================================================
  const templatesData = [
    {
      id: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      firmId: null,
      name: "Freehold Purchase - Standard",
      description:
        "Standard workflow for residential freehold purchase including searches, enquiries, exchange and completion",
      practiceArea: "conveyancing" as const,
      subType: "freehold_purchase",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      firmId: null,
      name: "Freehold Sale - Standard",
      description: "Standard workflow for residential freehold sale",
      practiceArea: "conveyancing" as const,
      subType: "freehold_sale",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.conveyancingLeaseholdPurchase,
      firmId: null,
      name: "Leasehold Purchase - Standard",
      description:
        "Standard workflow for leasehold property purchase with management company checks",
      practiceArea: "conveyancing" as const,
      subType: "leasehold_purchase",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      firmId: null,
      name: "Debt Recovery - Pre-Action to Enforcement",
      description: "Full debt recovery workflow from letter before action through to enforcement",
      practiceArea: "litigation" as const,
      subType: "debt_recovery",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.familyDivorcePetition,
      firmId: null,
      name: "Divorce Petition - Full Process",
      description: "No-fault divorce application process including financial settlement",
      practiceArea: "family" as const,
      subType: "divorce_petition",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.familyChildArrangements,
      firmId: null,
      name: "Child Arrangements - C100 Application",
      description: "Child arrangements order application workflow",
      practiceArea: "family" as const,
      subType: "child_arrangements",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      firmId: null,
      name: "Grant of Probate - Standard Estate",
      description: "Standard probate application and estate administration workflow",
      practiceArea: "probate" as const,
      subType: "grant_of_probate",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.employmentUnfairDismissal,
      firmId: null,
      name: "Unfair Dismissal Claim - Full Process",
      description: "Employment tribunal claim for unfair dismissal",
      practiceArea: "employment" as const,
      subType: "unfair_dismissal",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.personalInjuryRTA,
      firmId: null,
      name: "Road Traffic Accident Claim",
      description: "Personal injury claim following RTA under Pre-Action Protocol",
      practiceArea: "personal_injury" as const,
      subType: "road_traffic_accident",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
    {
      id: DEMO_IDS.taskTemplates.immigrationSkilledWorker,
      firmId: null,
      name: "Skilled Worker Visa Application",
      description: "Complete application process for Skilled Worker visa",
      practiceArea: "immigration" as const,
      subType: "skilled_worker_visa",
      isDefault: true,
      isActive: true,
      createdById: null,
      createdAt: now,
      updatedAt: now,
    },
  ];

  for (const template of templatesData) {
    await db
      .insert(taskTemplates)
      .values(template)
      .onConflictDoUpdate({
        target: taskTemplates.id,
        set: { updatedAt: now },
      });
    console.log(`    Created template: ${template.name}`);
  }

  // ================================================
  // TEMPLATE ITEMS
  // ================================================
  const itemsData = [
    // ----------------------
    // Conveyancing Freehold Purchase (15 items)
    // ----------------------
    {
      id: DEMO_IDS.taskTemplateItems.cfp1,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Send client care letter and terms of engagement",
      description: "SRA requirement: Provide written terms of business including costs estimate",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 1,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 1,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp2,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Complete AML identity verification",
      description: "Verify client identity under Money Laundering Regulations 2017",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 3,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 2,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp3,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Source of funds verification",
      description: "Verify source of deposit and purchase funds (AML requirement)",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 7,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 3,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp4,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Request contract pack from seller's solicitors",
      description: "Request draft contract, title documents, and property information forms",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 2,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 4,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp5,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Order property searches",
      description: "Order local authority, drainage, environmental, and chancel searches",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 5,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 5,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp6,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Review title documents",
      description:
        "Check title for restrictions, covenants, and any matters affecting the property",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 10,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 6,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp7,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Raise enquiries with seller's solicitors",
      description: "Send standard and additional enquiries based on title and search results",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: 14,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 7,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp8,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Review mortgage offer",
      description: "Check mortgage terms, conditions, and special conditions",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: null,
      dueDateAnchor: null,
      assigneeRole: "fee_earner" as const,
      sortOrder: 8,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp9,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Report on title to client",
      description: "Prepare comprehensive report on property title and search results",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 21,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 9,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp10,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Report on title to lender",
      description: "Submit Certificate of Title to mortgage lender",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: null,
      dueDateAnchor: null,
      assigneeRole: "fee_earner" as const,
      sortOrder: 10,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp11,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Request OS1 priority search",
      description: "Order official search with priority for 30-day protection",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: -3,
      dueDateAnchor: "completion" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 11,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp12,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Prepare completion statement",
      description: "Calculate all completion monies including SDLT and disbursements",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: -5,
      dueDateAnchor: "completion" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 12,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp13,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Exchange contracts",
      description: "Exchange contracts using Law Society formula",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: -14,
      dueDateAnchor: "completion" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 13,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp14,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Complete purchase and obtain keys",
      description: "Complete purchase, release keys, and confirm to client",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 0,
      dueDateAnchor: "completion" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 14,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfp15,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdPurchase,
      title: "Submit SDLT return and register title",
      description: "File SDLT return within 14 days and submit AP1 to Land Registry",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 14,
      dueDateAnchor: "completion" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 15,
      createdAt: now,
    },

    // ----------------------
    // Conveyancing Freehold Sale (10 items)
    // ----------------------
    {
      id: DEMO_IDS.taskTemplateItems.cfs1,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Send client care letter and terms of engagement",
      description: "SRA requirement: Provide written terms of business",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 1,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 1,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs2,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Complete AML identity verification",
      description: "Verify client identity under Money Laundering Regulations",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 3,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 2,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs3,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Obtain official copies of title",
      description: "Order up-to-date title register and plan from Land Registry",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 2,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 3,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs4,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Send property information forms to client",
      description: "Send TA6, TA10, and fittings list for completion",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 2,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 4,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs5,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Draft contract and prepare contract pack",
      description: "Prepare draft contract with all supporting documentation",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 7,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 5,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs6,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Respond to buyer's enquiries",
      description: "Prepare detailed responses to pre-contract enquiries",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: 14,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 6,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs7,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Obtain redemption statement from lender",
      description: "Request mortgage redemption figure for completion date",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: -7,
      dueDateAnchor: "completion" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 7,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs8,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Exchange contracts",
      description: "Exchange contracts and confirm deposit received",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: -14,
      dueDateAnchor: "completion" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 8,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs9,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Complete sale and release keys",
      description: "Complete transaction, receive funds, authorise key release",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 0,
      dueDateAnchor: "completion" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 9,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.cfs10,
      templateId: DEMO_IDS.taskTemplates.conveyancingFreeholdSale,
      title: "Redeem mortgage and send net proceeds",
      description: "Pay off mortgage and transfer balance to client",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 1,
      dueDateAnchor: "completion" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 10,
      createdAt: now,
    },

    // ----------------------
    // Litigation Debt Recovery (8 items)
    // ----------------------
    {
      id: DEMO_IDS.taskTemplateItems.ldr1,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Send client care letter and funding advice",
      description: "SRA requirement: Confirm retainer and costs information",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 1,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 1,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.ldr2,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Complete AML checks",
      description: "Verify client identity (Money Laundering Regulations)",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 3,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 2,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.ldr3,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Send Letter Before Action",
      description: "Pre-Action Protocol compliant LBA with 30-day response period",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 5,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 3,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.ldr4,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Issue claim form (N1)",
      description: "Issue county court money claim if no response to LBA",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 35,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 4,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.ldr5,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Serve particulars of claim",
      description: "Serve POC within 14 days of issue (or with claim form)",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 49,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 5,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.ldr6,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Request judgment in default",
      description: "Apply for default judgment if no acknowledgement/defence",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: 70,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 6,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.ldr7,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Consider enforcement options",
      description: "Advise on High Court writ, attachment of earnings, charging order",
      mandatory: false,
      category: "best_practice" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: null,
      dueDateAnchor: null,
      assigneeRole: "fee_earner" as const,
      sortOrder: 7,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.ldr8,
      templateId: DEMO_IDS.taskTemplates.litigationDebtRecovery,
      title: "Conduct bankruptcy/solvency check on debtor",
      description: "Companies House and individual insolvency register checks",
      mandatory: false,
      category: "best_practice" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: 2,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 8,
      createdAt: now,
    },

    // ----------------------
    // Family Divorce Petition (8 items)
    // ----------------------
    {
      id: DEMO_IDS.taskTemplateItems.fd1,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "Send client care letter",
      description: "SRA requirement: Confirm retainer and costs estimate",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 1,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 1,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.fd2,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "Complete AML identity verification",
      description: "Verify client identity (Money Laundering Regulations)",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 3,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 2,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.fd3,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "Obtain marriage certificate",
      description: "Request certified copy if original not available",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 7,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 3,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.fd4,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "File divorce application online",
      description: "Submit D8 application via MyHMCTS portal",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 14,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 4,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.fd5,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "Apply for conditional order",
      description: "Apply after 20 weeks from issue (no-fault divorce)",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: 140,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 5,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.fd6,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "Apply for final order",
      description: "Apply 6 weeks after conditional order granted",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 182,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 6,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.fd7,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "Complete Form E financial disclosure",
      description: "Prepare full financial disclosure if financial remedy sought",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: null,
      dueDateAnchor: null,
      assigneeRole: "fee_earner" as const,
      sortOrder: 7,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.fd8,
      templateId: DEMO_IDS.taskTemplates.familyDivorcePetition,
      title: "Draft consent order for finances",
      description: "Prepare consent order reflecting agreed financial settlement",
      mandatory: false,
      category: "legal" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: null,
      dueDateAnchor: null,
      assigneeRole: "fee_earner" as const,
      sortOrder: 8,
      createdAt: now,
    },

    // ----------------------
    // Probate Grant of Probate (8 items)
    // ----------------------
    {
      id: DEMO_IDS.taskTemplateItems.pg1,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Send client care letter and terms",
      description: "SRA requirement: Confirm retainer and costs estimate",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 1,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 1,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pg2,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Complete AML checks on all executors",
      description: "Verify identity of all executors (AML regulations)",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 7,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 2,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pg3,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Obtain original will and death certificate",
      description: "Secure original documents required for application",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 7,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 3,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pg4,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Value estate assets",
      description: "Obtain valuations for property, investments, and personal effects",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 21,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 4,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pg5,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Prepare IHT forms",
      description: "Complete IHT400 or IHT205 as appropriate",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 28,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 5,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pg6,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Submit PA1P application online",
      description: "Submit probate application via online portal",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 35,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 6,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pg7,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Place statutory notices",
      description: "Advertise for creditors (Trustee Act s.27 protection)",
      mandatory: false,
      category: "best_practice" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: null,
      dueDateAnchor: null,
      assigneeRole: "paralegal" as const,
      sortOrder: 7,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pg8,
      templateId: DEMO_IDS.taskTemplates.probateGrantOfProbate,
      title: "Collect in assets and distribute estate",
      description: "Realise assets and distribute according to will/intestacy",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: null,
      dueDateAnchor: null,
      assigneeRole: "fee_earner" as const,
      sortOrder: 8,
      createdAt: now,
    },

    // ----------------------
    // Personal Injury RTA (8 items)
    // ----------------------
    {
      id: DEMO_IDS.taskTemplateItems.pi1,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Send client care letter and CFA",
      description: "SRA requirement: Confirm retainer and funding arrangement",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 1,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 1,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pi2,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Complete AML identity verification",
      description: "Verify client identity (Money Laundering Regulations)",
      mandatory: true,
      category: "regulatory" as const,
      defaultPriority: "urgent" as const,
      relativeDueDays: 3,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 2,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pi3,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Obtain police accident report",
      description: "Request copy of police report and witness details",
      mandatory: false,
      category: "best_practice" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: 7,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 3,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pi4,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Request medical records",
      description: "Obtain full medical records from GP and treating hospitals",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 7,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "paralegal" as const,
      sortOrder: 4,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pi5,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Send CNF to defendant's insurer",
      description: "Submit Claim Notification Form under PI Protocol",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 21,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 5,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pi6,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Instruct medical expert",
      description: "Commission medico-legal report on injuries",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 30,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 6,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pi7,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Send Letter of Claim with medical evidence",
      description: "Full Letter of Claim with schedule of losses and medical report",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "high" as const,
      relativeDueDays: 90,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 7,
      createdAt: now,
    },
    {
      id: DEMO_IDS.taskTemplateItems.pi8,
      templateId: DEMO_IDS.taskTemplates.personalInjuryRTA,
      title: "Negotiate settlement or issue proceedings",
      description: "Pursue settlement or file court proceedings if liability disputed",
      mandatory: true,
      category: "legal" as const,
      defaultPriority: "medium" as const,
      relativeDueDays: 120,
      dueDateAnchor: "matter_opened" as const,
      assigneeRole: "fee_earner" as const,
      sortOrder: 8,
      createdAt: now,
    },
  ];

  for (const item of itemsData) {
    await db
      .insert(taskTemplateItems)
      .values(item)
      .onConflictDoUpdate({
        target: taskTemplateItems.id,
        set: { title: item.title }, // Just update title on conflict
      });
  }
  console.log(`    Created ${itemsData.length} template items`);

  console.log(`  Created ${templatesData.length} task templates with items`);
}
